{"version":3,"sources":["@wordpress/reusable-blocks/src/components/reusable-blocks-menu-items/reusable-block-delete-button.js"],"names":["MenuItem","__","isReusableBlock","useSelect","useDispatch","useCallback","BlockSettingsMenuControls","STORE_KEY","ReusableBlockDeleteButton","clientId","select","getBlock","canUser","blockObj","reusableBlock","getEntityRecord","attributes","ref","block","isVisible","isTemporary","id","isDisabled","deleteReusableBlock","__experimentalDeleteReusableBlock","createSuccessNotice","createErrorNotice","onDelete","type","message","onClose","hasConfirmed","window","confirm"],"mappings":";;;;AAAA;;;AAGA,SAASA,QAAT,QAAyB,uBAAzB;AACA,SAASC,EAAT,QAAmB,iBAAnB;AACA,SAASC,eAAT,QAAgC,mBAAhC;AACA,SAASC,SAAT,EAAoBC,WAApB,QAAuC,iBAAvC;AACA,SAASC,WAAT,QAA4B,oBAA5B;AACA,SAASC,yBAAT,QAA0C,yBAA1C;AAEA;;;;AAGA,SAASC,SAAT,QAA0B,uBAA1B;;AAEA,SAASC,yBAAT,OAAmD;AAAA,MAAbC,QAAa,QAAbA,QAAa;;AAAA,mBACTN,SAAS,CACjD,UAAEO,MAAF,EAAc;AAAA,kBACQA,MAAM,CAAE,mBAAF,CADd;AAAA,QACLC,QADK,WACLA,QADK;;AAAA,mBAEOD,MAAM,CAAE,MAAF,CAFb;AAAA,QAELE,OAFK,YAELA,OAFK;;AAGb,QAAMC,QAAQ,GAAGF,QAAQ,CAAEF,QAAF,CAAzB;AAEA,QAAMK,aAAa,GAClBD,QAAQ,IAAIX,eAAe,CAAEW,QAAF,CAA3B,GACGH,MAAM,CAAE,MAAF,CAAN,CAAiBK,eAAjB,CACA,UADA,EAEA,UAFA,EAGAF,QAAQ,CAACG,UAAT,CAAoBC,GAHpB,CADH,GAMG,IAPJ;AASA,WAAO;AACNC,MAAAA,KAAK,EAAEL,QADD;AAENM,MAAAA,SAAS,EACR,CAAC,CAAEL,aAAH,KACEA,aAAa,CAACM,WAAd,IACD,CAAC,CAAER,OAAO,CAAE,QAAF,EAAY,QAAZ,EAAsBE,aAAa,CAACO,EAApC,CAFX,CAHK;AAMNC,MAAAA,UAAU,EAAER,aAAa,IAAIA,aAAa,CAACM;AANrC,KAAP;AAQA,GAvBgD,EAwBjD,CAAEX,QAAF,CAxBiD,CADA;AAAA,MAC1CU,SAD0C,cAC1CA,SAD0C;AAAA,MAC/BG,UAD+B,cAC/BA,UAD+B;AAAA,MACnBJ,KADmB,cACnBA,KADmB;;AAAA,qBA8B9Cd,WAAW,CAAEG,SAAF,CA9BmC;AAAA,MA6BdgB,mBA7Bc,gBA6BjDC,iCA7BiD;;AAAA,sBAgCCpB,WAAW,CAC7D,cAD6D,CAhCZ;AAAA,MAgC1CqB,mBAhC0C,iBAgC1CA,mBAhC0C;AAAA,MAgCrBC,iBAhCqB,iBAgCrBA,iBAhCqB;;AAmClD,MAAMC,QAAQ,GAAGtB,WAAW,wEAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAEQkB,mBAAmB,CAAEL,KAAK,CAACF,UAAN,CAAiBC,GAAnB,CAF3B;;AAAA;AAGEQ,YAAAA,mBAAmB,CAAExB,EAAE,CAAE,gBAAF,CAAJ,EAA0B;AAC5C2B,cAAAA,IAAI,EAAE;AADsC,aAA1B,CAAnB;AAHF;AAAA;;AAAA;AAAA;AAAA;AAOEF,YAAAA,iBAAiB,CAAE,YAAMG,OAAR,EAAiB;AACjCD,cAAAA,IAAI,EAAE;AAD2B,aAAjB,CAAjB;;AAPF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAD2B,IAa3B,CAAEV,KAAF,CAb2B,CAA5B;;AAgBA,MAAK,CAAEC,SAAP,EAAmB;AAClB,WAAO,IAAP;AACA;;AAED,SACC,cAAC,yBAAD,QACG;AAAA,QAAIW,OAAJ,SAAIA,OAAJ;AAAA,WACD,cAAC,QAAD;AACC,MAAA,QAAQ,EAAGR,UADZ;AAEC,MAAA,OAAO,EAAG,mBAAM;AACf;AACA,YAAMS,YAAY,GAAGC,MAAM,CAACC,OAAP,EACpB;AACAhC,QAAAA,EAAE,CACD,6DACC,sEAFA,CAFkB,CAArB;;AAOA,YAAK8B,YAAL,EAAoB;AACnBJ,UAAAA,QAAQ;AACRG,UAAAA,OAAO;AACP;AACD;AAfF,OAiBG7B,EAAE,CAAE,6BAAF,CAjBL,CADC;AAAA,GADH,CADD;AAyBA;;AAED,eAAeO,yBAAf","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { MenuItem } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { isReusableBlock } from '@wordpress/blocks';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useCallback } from '@wordpress/element';\nimport { BlockSettingsMenuControls } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { STORE_KEY } from '../../store/constants';\n\nfunction ReusableBlockDeleteButton( { clientId } ) {\n\tconst { isVisible, isDisabled, block } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getBlock } = select( 'core/block-editor' );\n\t\t\tconst { canUser } = select( 'core' );\n\t\t\tconst blockObj = getBlock( clientId );\n\n\t\t\tconst reusableBlock =\n\t\t\t\tblockObj && isReusableBlock( blockObj )\n\t\t\t\t\t? select( 'core' ).getEntityRecord(\n\t\t\t\t\t\t\t'postType',\n\t\t\t\t\t\t\t'wp_block',\n\t\t\t\t\t\t\tblockObj.attributes.ref\n\t\t\t\t\t  )\n\t\t\t\t\t: null;\n\n\t\t\treturn {\n\t\t\t\tblock: blockObj,\n\t\t\t\tisVisible:\n\t\t\t\t\t!! reusableBlock &&\n\t\t\t\t\t( reusableBlock.isTemporary ||\n\t\t\t\t\t\t!! canUser( 'delete', 'blocks', reusableBlock.id ) ),\n\t\t\t\tisDisabled: reusableBlock && reusableBlock.isTemporary,\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\n\tconst {\n\t\t__experimentalDeleteReusableBlock: deleteReusableBlock,\n\t} = useDispatch( STORE_KEY );\n\n\tconst { createSuccessNotice, createErrorNotice } = useDispatch(\n\t\t'core/notices'\n\t);\n\tconst onDelete = useCallback(\n\t\tasync function () {\n\t\t\ttry {\n\t\t\t\tawait deleteReusableBlock( block.attributes.ref );\n\t\t\t\tcreateSuccessNotice( __( 'Block deleted.' ), {\n\t\t\t\t\ttype: 'snackbar',\n\t\t\t\t} );\n\t\t\t} catch ( error ) {\n\t\t\t\tcreateErrorNotice( error.message, {\n\t\t\t\t\ttype: 'snackbar',\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\t[ block ]\n\t);\n\n\tif ( ! isVisible ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<BlockSettingsMenuControls>\n\t\t\t{ ( { onClose } ) => (\n\t\t\t\t<MenuItem\n\t\t\t\t\tdisabled={ isDisabled }\n\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t// eslint-disable-next-line no-alert\n\t\t\t\t\t\tconst hasConfirmed = window.confirm(\n\t\t\t\t\t\t\t// eslint-disable-next-line @wordpress/i18n-no-collapsible-whitespace\n\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t'Are you sure you want to delete this Reusable Block?\\n\\n' +\n\t\t\t\t\t\t\t\t\t'It will be permanently removed from all posts and pages that use it.'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif ( hasConfirmed ) {\n\t\t\t\t\t\t\tonDelete();\n\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t}\n\t\t\t\t\t} }\n\t\t\t\t>\n\t\t\t\t\t{ __( 'Remove from Reusable blocks' ) }\n\t\t\t\t</MenuItem>\n\t\t\t) }\n\t\t</BlockSettingsMenuControls>\n\t);\n}\n\nexport default ReusableBlockDeleteButton;\n"]}