{"version":3,"sources":["@wordpress/block-editor/src/components/block-list-appender/index.js"],"names":["last","classnames","createContext","useContext","withSelect","getDefaultBlockName","DefaultBlockAppender","ButtonBlockAppender","AppenderNodesContext","stopPropagation","event","BlockListAppender","blockClientIds","rootClientId","canInsertDefaultBlock","isLocked","CustomAppender","renderAppender","className","selectedBlockClientId","tagName","TagName","appenderNodesMap","appender","isDocumentAppender","isParentSelected","isAnotherDefaultAppenderAlreadyDisplayed","includes","ref","set","delete","select","getBlockOrder","canInsertBlockType","getTemplateLock","getSelectedBlockClientId"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { last } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { createContext, useContext } from '@wordpress/element';\nimport { withSelect } from '@wordpress/data';\nimport { getDefaultBlockName } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport DefaultBlockAppender from '../default-block-appender';\nimport ButtonBlockAppender from '../button-block-appender';\n\n// A Context to store the map of the appender map.\nexport const AppenderNodesContext = createContext();\n\nfunction stopPropagation( event ) {\n\tevent.stopPropagation();\n}\n\nfunction BlockListAppender( {\n\tblockClientIds,\n\trootClientId,\n\tcanInsertDefaultBlock,\n\tisLocked,\n\trenderAppender: CustomAppender,\n\tclassName,\n\tselectedBlockClientId,\n\ttagName: TagName = 'div',\n} ) {\n\tconst appenderNodesMap = useContext( AppenderNodesContext );\n\n\tif ( isLocked || CustomAppender === false ) {\n\t\treturn null;\n\t}\n\n\tlet appender;\n\tif ( CustomAppender ) {\n\t\t// Prefer custom render prop if provided.\n\t\tappender = <CustomAppender />;\n\t} else {\n\t\tconst isDocumentAppender = ! rootClientId;\n\t\tconst isParentSelected = selectedBlockClientId === rootClientId;\n\t\tconst isAnotherDefaultAppenderAlreadyDisplayed =\n\t\t\tselectedBlockClientId &&\n\t\t\t! blockClientIds.includes( selectedBlockClientId );\n\n\t\tif (\n\t\t\t! isDocumentAppender &&\n\t\t\t! isParentSelected &&\n\t\t\t( ! selectedBlockClientId ||\n\t\t\t\tisAnotherDefaultAppenderAlreadyDisplayed )\n\t\t) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( canInsertDefaultBlock ) {\n\t\t\t// Render the default block appender when renderAppender has not been\n\t\t\t// provided and the context supports use of the default appender.\n\t\t\tappender = (\n\t\t\t\t<DefaultBlockAppender\n\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\tlastBlockClientId={ last( blockClientIds ) }\n\t\t\t\t/>\n\t\t\t);\n\t\t} else {\n\t\t\t// Fallback in the case no renderAppender has been provided and the\n\t\t\t// default block can't be inserted.\n\t\t\tappender = (\n\t\t\t\t<ButtonBlockAppender\n\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\tclassName=\"block-list-appender__toggle\"\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t}\n\n\treturn (\n\t\t<TagName\n\t\t\t// A `tabIndex` is used on the wrapping `div` element in order to\n\t\t\t// force a focus event to occur when an appender `button` element\n\t\t\t// is clicked. In some browsers (Firefox, Safari), button clicks do\n\t\t\t// not emit a focus event, which could cause this event to propagate\n\t\t\t// unexpectedly. The `tabIndex` ensures that the interaction is\n\t\t\t// captured as a focus, without also adding an extra tab stop.\n\t\t\t//\n\t\t\t// See: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\t\t\ttabIndex={ -1 }\n\t\t\t// Prevent the block from being selected when the appender is\n\t\t\t// clicked.\n\t\t\tonFocus={ stopPropagation }\n\t\t\tclassName={ classnames(\n\t\t\t\t'block-list-appender',\n\t\t\t\t'wp-block',\n\t\t\t\tclassName\n\t\t\t) }\n\t\t\tref={ ( ref ) => {\n\t\t\t\tif ( ref ) {\n\t\t\t\t\t// Set the reference of the \"Appender\" with `rootClientId` as key.\n\t\t\t\t\tappenderNodesMap.set( rootClientId || '', ref );\n\t\t\t\t} else {\n\t\t\t\t\t// If it un-mounts, cleanup the map.\n\t\t\t\t\tappenderNodesMap.delete( rootClientId || '' );\n\t\t\t\t}\n\t\t\t} }\n\t\t>\n\t\t\t{ appender }\n\t\t</TagName>\n\t);\n}\n\nexport default withSelect( ( select, { rootClientId } ) => {\n\tconst {\n\t\tgetBlockOrder,\n\t\tcanInsertBlockType,\n\t\tgetTemplateLock,\n\t\tgetSelectedBlockClientId,\n\t} = select( 'core/block-editor' );\n\n\treturn {\n\t\tisLocked: !! getTemplateLock( rootClientId ),\n\t\tblockClientIds: getBlockOrder( rootClientId ),\n\t\tcanInsertDefaultBlock: canInsertBlockType(\n\t\t\tgetDefaultBlockName(),\n\t\t\trootClientId\n\t\t),\n\t\tselectedBlockClientId: getSelectedBlockClientId(),\n\t};\n} )( BlockListAppender );\n"]}