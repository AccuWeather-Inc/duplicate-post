{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/index.js"],"names":["appenderNodesMap","Map","BLOCK_ANIMATION_THRESHOLD","BlockList","ref","className","placeholder","rootClientId","renderAppender","Container","RootContainer","fallbackRef","wrapperRef","Items","__experimentalAppenderTagName","selector","select","getBlockOrder","getBlockListSettings","getSettings","getSelectedBlockClientId","getMultiSelectedBlockClientIds","hasMultiSelection","getGlobalBlockCount","isTyping","__experimentalGetActiveBlockIdByBlockNames","activeEntityBlockId","__experimentalSpotlightEntityBlocks","blockClientIds","selectedBlockClientId","multiSelectedBlockClientIds","orientation","enableAnimation","dropTargetIndex","element","isAppenderDropTarget","length","map","clientId","index","isBlockInSelection","includes","isDropTarget","BlockListItems","props"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { AsyncModeProvider, useSelect } from '@wordpress/data';\nimport { useRef, forwardRef } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport BlockListBlock from './block';\nimport BlockListAppender, {\n\tAppenderNodesContext,\n} from '../block-list-appender';\nimport RootContainer from './root-container';\nimport useBlockDropZone from '../use-block-drop-zone';\n\n/**\n * A map to store the reference of each \"Appenders\" rendered with `rootClientId` as key.\n */\nconst appenderNodesMap = new Map();\n\n/**\n * If the block count exceeds the threshold, we disable the reordering animation\n * to avoid laginess.\n */\nconst BLOCK_ANIMATION_THRESHOLD = 200;\n\nfunction BlockList(\n\t{ className, placeholder, rootClientId, renderAppender },\n\tref\n) {\n\tconst Container = rootClientId ? 'div' : RootContainer;\n\tconst fallbackRef = useRef();\n\tconst wrapperRef = ref || fallbackRef;\n\n\treturn (\n\t\t<AppenderNodesContext.Provider value={ appenderNodesMap }>\n\t\t\t<Container\n\t\t\t\tref={ wrapperRef }\n\t\t\t\tclassName={ classnames(\n\t\t\t\t\t'block-editor-block-list__layout',\n\t\t\t\t\tclassName\n\t\t\t\t) }\n\t\t\t>\n\t\t\t\t<BlockListItems\n\t\t\t\t\tplaceholder={ placeholder }\n\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\trenderAppender={ renderAppender }\n\t\t\t\t\twrapperRef={ wrapperRef }\n\t\t\t\t/>\n\t\t\t</Container>\n\t\t</AppenderNodesContext.Provider>\n\t);\n}\n\nfunction Items( {\n\tplaceholder,\n\trootClientId,\n\trenderAppender,\n\t__experimentalAppenderTagName,\n\twrapperRef,\n} ) {\n\tfunction selector( select ) {\n\t\tconst {\n\t\t\tgetBlockOrder,\n\t\t\tgetBlockListSettings,\n\t\t\tgetSettings,\n\t\t\tgetSelectedBlockClientId,\n\t\t\tgetMultiSelectedBlockClientIds,\n\t\t\thasMultiSelection,\n\t\t\tgetGlobalBlockCount,\n\t\t\tisTyping,\n\t\t\t__experimentalGetActiveBlockIdByBlockNames,\n\t\t} = select( 'core/block-editor' );\n\n\t\t// Determine if there is an active entity area to spotlight.\n\t\tconst activeEntityBlockId = __experimentalGetActiveBlockIdByBlockNames(\n\t\t\tgetSettings().__experimentalSpotlightEntityBlocks\n\t\t);\n\n\t\treturn {\n\t\t\tblockClientIds: getBlockOrder( rootClientId ),\n\t\t\tselectedBlockClientId: getSelectedBlockClientId(),\n\t\t\tmultiSelectedBlockClientIds: getMultiSelectedBlockClientIds(),\n\t\t\torientation: getBlockListSettings( rootClientId )?.orientation,\n\t\t\thasMultiSelection: hasMultiSelection(),\n\t\t\tenableAnimation:\n\t\t\t\t! isTyping() &&\n\t\t\t\tgetGlobalBlockCount() <= BLOCK_ANIMATION_THRESHOLD,\n\t\t\tactiveEntityBlockId,\n\t\t};\n\t}\n\n\tconst {\n\t\tblockClientIds,\n\t\tselectedBlockClientId,\n\t\tmultiSelectedBlockClientIds,\n\t\torientation,\n\t\thasMultiSelection,\n\t\tenableAnimation,\n\t\tactiveEntityBlockId,\n\t} = useSelect( selector, [ rootClientId ] );\n\n\tconst dropTargetIndex = useBlockDropZone( {\n\t\telement: wrapperRef,\n\t\trootClientId,\n\t} );\n\n\tconst isAppenderDropTarget = dropTargetIndex === blockClientIds.length;\n\n\treturn (\n\t\t<>\n\t\t\t{ blockClientIds.map( ( clientId, index ) => {\n\t\t\t\tconst isBlockInSelection = hasMultiSelection\n\t\t\t\t\t? multiSelectedBlockClientIds.includes( clientId )\n\t\t\t\t\t: selectedBlockClientId === clientId;\n\n\t\t\t\tconst isDropTarget = dropTargetIndex === index;\n\n\t\t\t\treturn (\n\t\t\t\t\t<AsyncModeProvider\n\t\t\t\t\t\tkey={ clientId }\n\t\t\t\t\t\tvalue={ ! isBlockInSelection }\n\t\t\t\t\t>\n\t\t\t\t\t\t<BlockListBlock\n\t\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\t\t// This prop is explicitely computed and passed down\n\t\t\t\t\t\t\t// to avoid being impacted by the async mode\n\t\t\t\t\t\t\t// otherwise there might be a small delay to trigger the animation.\n\t\t\t\t\t\t\tindex={ index }\n\t\t\t\t\t\t\tenableAnimation={ enableAnimation }\n\t\t\t\t\t\t\tclassName={ classnames( {\n\t\t\t\t\t\t\t\t'is-drop-target': isDropTarget,\n\t\t\t\t\t\t\t\t'is-dropping-horizontally':\n\t\t\t\t\t\t\t\t\tisDropTarget &&\n\t\t\t\t\t\t\t\t\torientation === 'horizontal',\n\t\t\t\t\t\t\t\t'has-active-entity': activeEntityBlockId,\n\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t\tactiveEntityBlockId={ activeEntityBlockId }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</AsyncModeProvider>\n\t\t\t\t);\n\t\t\t} ) }\n\t\t\t{ blockClientIds.length < 1 && placeholder }\n\t\t\t<BlockListAppender\n\t\t\t\ttagName={ __experimentalAppenderTagName }\n\t\t\t\trootClientId={ rootClientId }\n\t\t\t\trenderAppender={ renderAppender }\n\t\t\t\tclassName={ classnames( {\n\t\t\t\t\t'is-drop-target': isAppenderDropTarget,\n\t\t\t\t\t'is-dropping-horizontally':\n\t\t\t\t\t\tisAppenderDropTarget && orientation === 'horizontal',\n\t\t\t\t} ) }\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nexport function BlockListItems( props ) {\n\t// This component needs to always be synchronous as it's the one changing\n\t// the async mode depending on the block selection.\n\treturn (\n\t\t<AsyncModeProvider value={ false }>\n\t\t\t<Items { ...props } />\n\t\t</AsyncModeProvider>\n\t);\n}\n\nexport default forwardRef( BlockList );\n"]}