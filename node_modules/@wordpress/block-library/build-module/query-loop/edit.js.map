{"version":3,"sources":["@wordpress/block-library/src/query-loop/edit.js"],"names":["useState","useMemo","useSelect","__","BlockContextProvider","InnerBlocks","BlockPreview","useBlockProps","useQueryContext","TEMPLATE","QueryLoopEdit","clientId","context","query","perPage","offset","categoryIds","postType","tagIds","order","orderBy","author","search","exclude","queryContext","page","activeBlockContext","setActiveBlockContext","select","getEntityRecords","getBlocks","categories","tags","orderby","per_page","length","posts","blocks","blockContexts","map","post","type","postId","id","blockProps","blockContext"],"mappings":";;;AAAA;;;AAGA,SAASA,QAAT,EAAmBC,OAAnB,QAAkC,oBAAlC;AACA,SAASC,SAAT,QAA0B,iBAA1B;AACA,SAASC,EAAT,QAAmB,iBAAnB;AACA,SACCC,oBADD,EAECC,WAFD,EAGCC,YAHD,EAICC,aAJD,QAKO,yBALP;AAOA;;;;AAGA,SAASC,eAAT,QAAgC,UAAhC;AAEA,IAAMC,QAAQ,GAAG,CAChB,CAAE,iBAAF,CADgB,EAEhB,CAAE,gBAAF,CAFgB,EAGhB,CAAE,mBAAF,CAHgB,CAAjB;AAKA,eAAe,SAASC,aAAT,OAiBX;AAAA,MAhBHC,QAgBG,QAhBHA,QAgBG;AAAA,0BAfHC,OAeG;AAAA,wCAdFC,KAcE;AAAA,uDAHE,EAGF;AAAA,MAbDC,OAaC,sBAbDA,OAaC;AAAA,MAZDC,MAYC,sBAZDA,MAYC;AAAA,MAXDC,WAWC,sBAXDA,WAWC;AAAA,MAVDC,QAUC,sBAVDA,QAUC;AAAA,iDATDC,MASC;AAAA,MATDA,MASC,sCATQ,EASR;AAAA,MARDC,KAQC,sBARDA,KAQC;AAAA,MAPDC,OAOC,sBAPDA,OAOC;AAAA,MANDC,MAMC,sBANDA,MAMC;AAAA,MALDC,MAKC,sBALDA,MAKC;AAAA,MAJDC,OAIC,sBAJDA,OAIC;AAAA,MAFFC,YAEE,gBAFFA,YAEE;;AAAA,cACkBhB,eAAe,MAAMgB,YAArB,IAAqC,CAAE,EAAF,CADvD;AAAA;AAAA,MACOC,IADP,YACOA,IADP;;AAAA,kBAEmDzB,QAAQ,EAF3D;AAAA;AAAA,MAEK0B,kBAFL;AAAA,MAEyBC,qBAFzB;;AAAA,mBAIuBzB,SAAS,CAClC,UAAE0B,MAAF,EAAc;AAAA,kBACgBA,MAAM,CAAE,MAAF,CADtB;AAAA,QACLC,gBADK,WACLA,gBADK;;AAAA,mBAESD,MAAM,CAAE,mBAAF,CAFf;AAAA,QAELE,SAFK,YAELA,SAFK;;AAGb,QAAMjB,KAAK,GAAG;AACbE,MAAAA,MAAM,EAAED,OAAO,GAAGA,OAAO,IAAKW,IAAI,GAAG,CAAZ,CAAP,GAAyBV,MAA5B,GAAqC,CADvC;AAEbgB,MAAAA,UAAU,EAAEf,WAFC;AAGbgB,MAAAA,IAAI,EAAEd,MAHO;AAIbC,MAAAA,KAAK,EAALA,KAJa;AAKbc,MAAAA,OAAO,EAAEb;AALI,KAAd;;AAOA,QAAKN,OAAL,EAAe;AACdD,MAAAA,KAAK,CAACqB,QAAN,GAAiBpB,OAAjB;AACA;;AACD,QAAKO,MAAL,EAAc;AACbR,MAAAA,KAAK,CAACQ,MAAN,GAAeA,MAAf;AACA;;AACD,QAAKC,MAAL,EAAc;AACbT,MAAAA,KAAK,CAACS,MAAN,GAAeA,MAAf;AACA;;AACD,QAAKC,OAAL,aAAKA,OAAL,uBAAKA,OAAO,CAAEY,MAAd,EAAuB;AACtBtB,MAAAA,KAAK,CAACU,OAAN,GAAgBA,OAAhB;AACA;;AACD,WAAO;AACNa,MAAAA,KAAK,EAAEP,gBAAgB,CAAE,UAAF,EAAcZ,QAAd,EAAwBJ,KAAxB,CADjB;AAENwB,MAAAA,MAAM,EAAEP,SAAS,CAAEnB,QAAF;AAFX,KAAP;AAIA,GA3BiC,EA4BlC,CACCG,OADD,EAECW,IAFD,EAGCV,MAHD,EAICC,WAJD,EAKCE,MALD,EAMCC,KAND,EAOCC,OAPD,EAQCT,QARD,EASCU,MATD,EAUCC,MAVD,EAWCL,QAXD,EAYCM,OAZD,CA5BkC,CAJhC;AAAA,MAIKa,KAJL,cAIKA,KAJL;AAAA,MAIYC,MAJZ,cAIYA,MAJZ;;AAgDH,MAAMC,aAAa,GAAGrC,OAAO,CAC5B;AAAA,WACCmC,KADD,aACCA,KADD,uBACCA,KAAK,CAAEG,GAAP,CAAY,UAAEC,IAAF;AAAA,aAAc;AACzBvB,QAAAA,QAAQ,EAAEuB,IAAI,CAACC,IADU;AAEzBC,QAAAA,MAAM,EAAEF,IAAI,CAACG;AAFY,OAAd;AAAA,KAAZ,CADD;AAAA,GAD4B,EAM5B,CAAEP,KAAF,CAN4B,CAA7B;AAQA,MAAMQ,UAAU,GAAGrC,aAAa,EAAhC;;AAEA,MAAK,CAAE6B,KAAP,EAAe;AACd,WAAO,mBAAQQ,UAAR,EAAuBzC,EAAE,CAAE,UAAF,CAAzB,CAAP;AACA;;AAED,MAAK,CAAEiC,KAAK,CAACD,MAAb,EAAsB;AACrB,WAAO,mBAAQS,UAAR,OAAwBzC,EAAE,CAAE,mBAAF,CAA1B,CAAP;AACA;;AAED,SACC,qBAAUyC,UAAV,EACGN,aAAa,IACdA,aAAa,CAACC,GAAd,CAAmB,UAAEM,YAAF;AAAA,WAClB,cAAC,oBAAD;AACC,MAAA,GAAG,EAAGA,YAAY,CAACH,MADpB;AAEC,MAAA,KAAK,EAAGG;AAFT,OAIGA,YAAY,MACZnB,kBAAkB,IAAIY,aAAa,CAAE,CAAF,CADvB,CAAZ,GAED,cAAC,WAAD;AACC,MAAA,QAAQ,EAAG7B,QADZ;AAEC,MAAA,8BAA8B,EAAG;AAFlC,MAFC,GAOD,cAAC,YAAD;AACC,MAAA,MAAM,EAAG4B,MADV;AAEC,MAAA,kBAAkB,MAFnB;AAGC,MAAA,qBAAqB,EAAG;AAAA,eACvBV,qBAAqB,CAAEkB,YAAF,CADE;AAAA;AAHzB,MAXF,CADkB;AAAA,GAAnB,CAFF,CADD;AA2BA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useState, useMemo } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tBlockContextProvider,\n\tInnerBlocks,\n\tBlockPreview,\n\tuseBlockProps,\n} from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { useQueryContext } from '../query';\n\nconst TEMPLATE = [\n\t[ 'core/post-title' ],\n\t[ 'core/post-date' ],\n\t[ 'core/post-excerpt' ],\n];\nexport default function QueryLoopEdit( {\n\tclientId,\n\tcontext: {\n\t\tquery: {\n\t\t\tperPage,\n\t\t\toffset,\n\t\t\tcategoryIds,\n\t\t\tpostType,\n\t\t\ttagIds = [],\n\t\t\torder,\n\t\t\torderBy,\n\t\t\tauthor,\n\t\t\tsearch,\n\t\t\texclude,\n\t\t} = {},\n\t\tqueryContext,\n\t},\n} ) {\n\tconst [ { page } ] = useQueryContext() || queryContext || [ {} ];\n\tconst [ activeBlockContext, setActiveBlockContext ] = useState();\n\n\tconst { posts, blocks } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getEntityRecords } = select( 'core' );\n\t\t\tconst { getBlocks } = select( 'core/block-editor' );\n\t\t\tconst query = {\n\t\t\t\toffset: perPage ? perPage * ( page - 1 ) + offset : 0,\n\t\t\t\tcategories: categoryIds,\n\t\t\t\ttags: tagIds,\n\t\t\t\torder,\n\t\t\t\torderby: orderBy,\n\t\t\t};\n\t\t\tif ( perPage ) {\n\t\t\t\tquery.per_page = perPage;\n\t\t\t}\n\t\t\tif ( author ) {\n\t\t\t\tquery.author = author;\n\t\t\t}\n\t\t\tif ( search ) {\n\t\t\t\tquery.search = search;\n\t\t\t}\n\t\t\tif ( exclude?.length ) {\n\t\t\t\tquery.exclude = exclude;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tposts: getEntityRecords( 'postType', postType, query ),\n\t\t\t\tblocks: getBlocks( clientId ),\n\t\t\t};\n\t\t},\n\t\t[\n\t\t\tperPage,\n\t\t\tpage,\n\t\t\toffset,\n\t\t\tcategoryIds,\n\t\t\ttagIds,\n\t\t\torder,\n\t\t\torderBy,\n\t\t\tclientId,\n\t\t\tauthor,\n\t\t\tsearch,\n\t\t\tpostType,\n\t\t\texclude,\n\t\t]\n\t);\n\n\tconst blockContexts = useMemo(\n\t\t() =>\n\t\t\tposts?.map( ( post ) => ( {\n\t\t\t\tpostType: post.type,\n\t\t\t\tpostId: post.id,\n\t\t\t} ) ),\n\t\t[ posts ]\n\t);\n\tconst blockProps = useBlockProps();\n\n\tif ( ! posts ) {\n\t\treturn <p { ...blockProps }>{ __( 'Loadingâ€¦' ) }</p>;\n\t}\n\n\tif ( ! posts.length ) {\n\t\treturn <p { ...blockProps }> { __( 'No results found.' ) }</p>;\n\t}\n\n\treturn (\n\t\t<div { ...blockProps }>\n\t\t\t{ blockContexts &&\n\t\t\t\tblockContexts.map( ( blockContext ) => (\n\t\t\t\t\t<BlockContextProvider\n\t\t\t\t\t\tkey={ blockContext.postId }\n\t\t\t\t\t\tvalue={ blockContext }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ blockContext ===\n\t\t\t\t\t\t( activeBlockContext || blockContexts[ 0 ] ) ? (\n\t\t\t\t\t\t\t<InnerBlocks\n\t\t\t\t\t\t\t\ttemplate={ TEMPLATE }\n\t\t\t\t\t\t\t\ttemplateInsertUpdatesSelection={ false }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<BlockPreview\n\t\t\t\t\t\t\t\tblocks={ blocks }\n\t\t\t\t\t\t\t\t__experimentalLive\n\t\t\t\t\t\t\t\t__experimentalOnClick={ () =>\n\t\t\t\t\t\t\t\t\tsetActiveBlockContext( blockContext )\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</BlockContextProvider>\n\t\t\t\t) ) }\n\t\t</div>\n\t);\n}\n"]}