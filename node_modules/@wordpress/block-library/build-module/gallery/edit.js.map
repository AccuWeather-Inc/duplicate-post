{"version":3,"sources":["@wordpress/block-library/src/gallery/edit.js"],"names":["every","filter","find","forEach","get","isEmpty","map","reduce","some","toString","compose","PanelBody","SelectControl","ToggleControl","withNotices","RangeControl","MediaPlaceholder","InspectorControls","Platform","useEffect","useState","__","getBlobByURL","isBlobURL","revokeBlobURL","useDispatch","withSelect","withViewportMatch","sharedIcon","defaultColumnsNumber","pickRelevantMediaFiles","Gallery","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_MEDIA","LINK_DESTINATION_NONE","MAX_COLUMNS","linkOptions","value","label","ALLOWED_MEDIA_TYPES","PLACEHOLDER_TEXT","select","web","native","MOBILE_CONTROL_PROPS_RANGE_CONTROL","type","GalleryEdit","props","attributes","className","isSelected","noticeUI","noticeOperations","mediaUpload","imageSizes","resizedImages","onFocus","columns","imageCrop","images","linkTo","sizeSlug","selectedImage","setSelectedImage","attachmentCaptions","setAttachmentCaptions","__unstableMarkNextChangeAsNotPersistent","setAttributes","newAttrs","ids","Error","id","parseInt","onSelectImage","index","onDeselectImage","onMove","oldIndex","newIndex","newImages","splice","onMoveForward","length","onMoveBackward","onRemoveImage","img","i","Math","min","selectCaption","newImage","newImageId","currentImage","currentImageCaption","caption","attachment","onSelectImages","onUploadError","message","removeAllNotices","createErrorNotice","setLinkTo","setColumnsNumber","toggleImageCrop","getImageCropHelp","checked","onFocusGalleryCaption","setImageAttributes","newAttributes","slice","getImagesSizeOptions","slug","sizes","name","updateImagesSize","newSizeSlug","updatedImages","image","url","OS","filesList","onFileChange","allowedTypes","window","wp","media","view","settings","defaultProps","link","hasImages","mediaPlaceholder","title","instructions","undefined","imageSizeOptions","shouldShowSizeOptions","getMedia","getSettings","currentResizedImages","currentSizes","size","defaultUrl","mediaDetailsUrl","isNarrow"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tevery,\n\tfilter,\n\tfind,\n\tforEach,\n\tget,\n\tisEmpty,\n\tmap,\n\treduce,\n\tsome,\n\ttoString,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { compose } from '@wordpress/compose';\nimport {\n\tPanelBody,\n\tSelectControl,\n\tToggleControl,\n\twithNotices,\n\tRangeControl,\n} from '@wordpress/components';\nimport { MediaPlaceholder, InspectorControls } from '@wordpress/block-editor';\nimport { Platform, useEffect, useState } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { getBlobByURL, isBlobURL, revokeBlobURL } from '@wordpress/blob';\nimport { useDispatch, withSelect } from '@wordpress/data';\nimport { withViewportMatch } from '@wordpress/viewport';\n\n/**\n * Internal dependencies\n */\nimport { sharedIcon } from './shared-icon';\nimport { defaultColumnsNumber, pickRelevantMediaFiles } from './shared';\nimport Gallery from './gallery';\nimport {\n\tLINK_DESTINATION_ATTACHMENT,\n\tLINK_DESTINATION_MEDIA,\n\tLINK_DESTINATION_NONE,\n} from './constants';\n\nconst MAX_COLUMNS = 8;\nconst linkOptions = [\n\t{ value: LINK_DESTINATION_ATTACHMENT, label: __( 'Attachment Page' ) },\n\t{ value: LINK_DESTINATION_MEDIA, label: __( 'Media File' ) },\n\t{ value: LINK_DESTINATION_NONE, label: __( 'None' ) },\n];\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\nconst PLACEHOLDER_TEXT = Platform.select( {\n\tweb: __(\n\t\t'Drag images, upload new ones or select files from your library.'\n\t),\n\tnative: __( 'ADD MEDIA' ),\n} );\n\nconst MOBILE_CONTROL_PROPS_RANGE_CONTROL = Platform.select( {\n\tweb: {},\n\tnative: { type: 'stepper' },\n} );\n\nfunction GalleryEdit( props ) {\n\tconst {\n\t\tattributes,\n\t\tclassName,\n\t\tisSelected,\n\t\tnoticeUI,\n\t\tnoticeOperations,\n\t\tmediaUpload,\n\t\timageSizes,\n\t\tresizedImages,\n\t\tonFocus,\n\t} = props;\n\tconst {\n\t\tcolumns = defaultColumnsNumber( attributes ),\n\t\timageCrop,\n\t\timages,\n\t\tlinkTo,\n\t\tsizeSlug,\n\t} = attributes;\n\tconst [ selectedImage, setSelectedImage ] = useState();\n\tconst [ attachmentCaptions, setAttachmentCaptions ] = useState();\n\tconst { __unstableMarkNextChangeAsNotPersistent } = useDispatch(\n\t\t'core/block-editor'\n\t);\n\n\tfunction setAttributes( newAttrs ) {\n\t\tif ( newAttrs.ids ) {\n\t\t\tthrow new Error(\n\t\t\t\t'The \"ids\" attribute should not be changed directly. It is managed automatically when \"images\" attribute changes'\n\t\t\t);\n\t\t}\n\n\t\tif ( newAttrs.images ) {\n\t\t\tnewAttrs = {\n\t\t\t\t...newAttrs,\n\t\t\t\t// Unlike images[ n ].id which is a string, always ensure the\n\t\t\t\t// ids array contains numbers as per its attribute type.\n\t\t\t\tids: map( newAttrs.images, ( { id } ) => parseInt( id, 10 ) ),\n\t\t\t};\n\t\t}\n\n\t\tprops.setAttributes( newAttrs );\n\t}\n\n\tfunction onSelectImage( index ) {\n\t\treturn () => {\n\t\t\tsetSelectedImage( index );\n\t\t};\n\t}\n\n\tfunction onDeselectImage() {\n\t\treturn () => {\n\t\t\tsetSelectedImage();\n\t\t};\n\t}\n\n\tfunction onMove( oldIndex, newIndex ) {\n\t\tconst newImages = [ ...images ];\n\t\tnewImages.splice( newIndex, 1, images[ oldIndex ] );\n\t\tnewImages.splice( oldIndex, 1, images[ newIndex ] );\n\t\tsetSelectedImage( newIndex );\n\t\tsetAttributes( { images: newImages } );\n\t}\n\n\tfunction onMoveForward( oldIndex ) {\n\t\treturn () => {\n\t\t\tif ( oldIndex === images.length - 1 ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tonMove( oldIndex, oldIndex + 1 );\n\t\t};\n\t}\n\n\tfunction onMoveBackward( oldIndex ) {\n\t\treturn () => {\n\t\t\tif ( oldIndex === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tonMove( oldIndex, oldIndex - 1 );\n\t\t};\n\t}\n\n\tfunction onRemoveImage( index ) {\n\t\treturn () => {\n\t\t\tconst newImages = filter( images, ( img, i ) => index !== i );\n\t\t\tsetSelectedImage();\n\t\t\tsetAttributes( {\n\t\t\t\timages: newImages,\n\t\t\t\tcolumns: attributes.columns\n\t\t\t\t\t? Math.min( newImages.length, attributes.columns )\n\t\t\t\t\t: attributes.columns,\n\t\t\t} );\n\t\t};\n\t}\n\n\tfunction selectCaption( newImage ) {\n\t\t// The image id in both the images and attachmentCaptions arrays is a\n\t\t// string, so ensure comparison works correctly by converting the\n\t\t// newImage.id to a string.\n\t\tconst newImageId = toString( newImage.id );\n\t\tconst currentImage = find( images, { id: newImageId } );\n\t\tconst currentImageCaption = currentImage\n\t\t\t? currentImage.caption\n\t\t\t: newImage.caption;\n\n\t\tif ( ! attachmentCaptions ) {\n\t\t\treturn currentImageCaption;\n\t\t}\n\n\t\tconst attachment = find( attachmentCaptions, {\n\t\t\tid: newImageId,\n\t\t} );\n\n\t\t// if the attachment caption is updated\n\t\tif ( attachment && attachment.caption !== newImage.caption ) {\n\t\t\treturn newImage.caption;\n\t\t}\n\n\t\treturn currentImageCaption;\n\t}\n\n\tfunction onSelectImages( newImages ) {\n\t\tsetAttachmentCaptions(\n\t\t\tnewImages.map( ( newImage ) => ( {\n\t\t\t\t// Store the attachmentCaption id as a string for consistency\n\t\t\t\t// with the type of the id in the images attribute.\n\t\t\t\tid: toString( newImage.id ),\n\t\t\t\tcaption: newImage.caption,\n\t\t\t} ) )\n\t\t);\n\t\tsetAttributes( {\n\t\t\timages: newImages.map( ( newImage ) => ( {\n\t\t\t\t...pickRelevantMediaFiles( newImage, sizeSlug ),\n\t\t\t\tcaption: selectCaption( newImage, images, attachmentCaptions ),\n\t\t\t\t// The id value is stored in a data attribute, so when the\n\t\t\t\t// block is parsed it's converted to a string. Converting\n\t\t\t\t// to a string here ensures it's type is consistent.\n\t\t\t\tid: toString( newImage.id ),\n\t\t\t} ) ),\n\t\t\tcolumns: attributes.columns\n\t\t\t\t? Math.min( newImages.length, attributes.columns )\n\t\t\t\t: attributes.columns,\n\t\t} );\n\t}\n\n\tfunction onUploadError( message ) {\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t}\n\n\tfunction setLinkTo( value ) {\n\t\tsetAttributes( { linkTo: value } );\n\t}\n\n\tfunction setColumnsNumber( value ) {\n\t\tsetAttributes( { columns: value } );\n\t}\n\n\tfunction toggleImageCrop() {\n\t\tsetAttributes( { imageCrop: ! imageCrop } );\n\t}\n\n\tfunction getImageCropHelp( checked ) {\n\t\treturn checked\n\t\t\t? __( 'Thumbnails are cropped to align.' )\n\t\t\t: __( 'Thumbnails are not cropped.' );\n\t}\n\n\tfunction onFocusGalleryCaption() {\n\t\tsetSelectedImage();\n\t}\n\n\tfunction setImageAttributes( index, newAttributes ) {\n\t\tif ( ! images[ index ] ) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetAttributes( {\n\t\t\timages: [\n\t\t\t\t...images.slice( 0, index ),\n\t\t\t\t{\n\t\t\t\t\t...images[ index ],\n\t\t\t\t\t...newAttributes,\n\t\t\t\t},\n\t\t\t\t...images.slice( index + 1 ),\n\t\t\t],\n\t\t} );\n\t}\n\n\tfunction getImagesSizeOptions() {\n\t\treturn map(\n\t\t\tfilter( imageSizes, ( { slug } ) =>\n\t\t\t\tsome( resizedImages, ( sizes ) => sizes[ slug ] )\n\t\t\t),\n\t\t\t( { name, slug } ) => ( { value: slug, label: name } )\n\t\t);\n\t}\n\n\tfunction updateImagesSize( newSizeSlug ) {\n\t\tconst updatedImages = map( images, ( image ) => {\n\t\t\tif ( ! image.id ) {\n\t\t\t\treturn image;\n\t\t\t}\n\t\t\tconst url = get( resizedImages, [\n\t\t\t\tparseInt( image.id, 10 ),\n\t\t\t\tnewSizeSlug,\n\t\t\t] );\n\t\t\treturn {\n\t\t\t\t...image,\n\t\t\t\t...( url && { url } ),\n\t\t\t};\n\t\t} );\n\n\t\tsetAttributes( { images: updatedImages, newSizeSlug } );\n\t}\n\n\tuseEffect( () => {\n\t\tif (\n\t\t\tPlatform.OS === 'web' &&\n\t\t\timages &&\n\t\t\timages.length > 0 &&\n\t\t\tevery( images, ( { url } ) => isBlobURL( url ) )\n\t\t) {\n\t\t\tconst filesList = map( images, ( { url } ) => getBlobByURL( url ) );\n\t\t\tforEach( images, ( { url } ) => revokeBlobURL( url ) );\n\t\t\tmediaUpload( {\n\t\t\t\tfilesList,\n\t\t\t\tonFileChange: onSelectImages,\n\t\t\t\tallowedTypes: [ 'image' ],\n\t\t\t} );\n\t\t}\n\t}, [] );\n\n\tuseEffect( () => {\n\t\t// Deselect images when deselecting the block\n\t\tif ( ! isSelected ) {\n\t\t\tsetSelectedImage();\n\t\t}\n\t}, [ isSelected ] );\n\n\tuseEffect( () => {\n\t\t// linkTo attribute must be saved so blocks don't break when changing\n\t\t// image_default_link_type in options.php\n\t\tif ( ! linkTo ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\tsetAttributes( {\n\t\t\t\tlinkTo:\n\t\t\t\t\twindow?.wp?.media?.view?.settings?.defaultProps?.link ||\n\t\t\t\t\tLINK_DESTINATION_NONE,\n\t\t\t} );\n\t\t}\n\t}, [ linkTo ] );\n\n\tconst hasImages = !! images.length;\n\n\tconst mediaPlaceholder = (\n\t\t<MediaPlaceholder\n\t\t\taddToGallery={ hasImages }\n\t\t\tisAppender={ hasImages }\n\t\t\tclassName={ className }\n\t\t\tdisableMediaButtons={ hasImages && ! isSelected }\n\t\t\ticon={ ! hasImages && sharedIcon }\n\t\t\tlabels={ {\n\t\t\t\ttitle: ! hasImages && __( 'Gallery' ),\n\t\t\t\tinstructions: ! hasImages && PLACEHOLDER_TEXT,\n\t\t\t} }\n\t\t\tonSelect={ onSelectImages }\n\t\t\taccept=\"image/*\"\n\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\tmultiple\n\t\t\tvalue={ images }\n\t\t\tonError={ onUploadError }\n\t\t\tnotices={ hasImages ? undefined : noticeUI }\n\t\t\tonFocus={ onFocus }\n\t\t/>\n\t);\n\n\tif ( ! hasImages ) {\n\t\treturn mediaPlaceholder;\n\t}\n\n\tconst imageSizeOptions = getImagesSizeOptions();\n\tconst shouldShowSizeOptions = hasImages && ! isEmpty( imageSizeOptions );\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Gallery settings' ) }>\n\t\t\t\t\t{ images.length > 1 && (\n\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\tlabel={ __( 'Columns' ) }\n\t\t\t\t\t\t\tvalue={ columns }\n\t\t\t\t\t\t\tonChange={ setColumnsNumber }\n\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\tmax={ Math.min( MAX_COLUMNS, images.length ) }\n\t\t\t\t\t\t\t{ ...MOBILE_CONTROL_PROPS_RANGE_CONTROL }\n\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Crop images' ) }\n\t\t\t\t\t\tchecked={ !! imageCrop }\n\t\t\t\t\t\tonChange={ toggleImageCrop }\n\t\t\t\t\t\thelp={ getImageCropHelp }\n\t\t\t\t\t/>\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\tlabel={ __( 'Link to' ) }\n\t\t\t\t\t\tvalue={ linkTo }\n\t\t\t\t\t\tonChange={ setLinkTo }\n\t\t\t\t\t\toptions={ linkOptions }\n\t\t\t\t\t/>\n\t\t\t\t\t{ shouldShowSizeOptions && (\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\tlabel={ __( 'Image size' ) }\n\t\t\t\t\t\t\tvalue={ sizeSlug }\n\t\t\t\t\t\t\toptions={ imageSizeOptions }\n\t\t\t\t\t\t\tonChange={ updateImagesSize }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t{ noticeUI }\n\t\t\t<Gallery\n\t\t\t\t{ ...props }\n\t\t\t\tselectedImage={ selectedImage }\n\t\t\t\tmediaPlaceholder={ mediaPlaceholder }\n\t\t\t\tonMoveBackward={ onMoveBackward }\n\t\t\t\tonMoveForward={ onMoveForward }\n\t\t\t\tonRemoveImage={ onRemoveImage }\n\t\t\t\tonSelectImage={ onSelectImage }\n\t\t\t\tonDeselectImage={ onDeselectImage }\n\t\t\t\tonSetImageAttributes={ setImageAttributes }\n\t\t\t\tonFocusGalleryCaption={ onFocusGalleryCaption }\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nexport default compose( [\n\twithSelect( ( select, { attributes: { ids }, isSelected } ) => {\n\t\tconst { getMedia } = select( 'core' );\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\tconst { imageSizes, mediaUpload } = getSettings();\n\n\t\tlet resizedImages = {};\n\n\t\tif ( isSelected ) {\n\t\t\tresizedImages = reduce(\n\t\t\t\tids,\n\t\t\t\t( currentResizedImages, id ) => {\n\t\t\t\t\tif ( ! id ) {\n\t\t\t\t\t\treturn currentResizedImages;\n\t\t\t\t\t}\n\t\t\t\t\tconst image = getMedia( id );\n\t\t\t\t\tconst sizes = reduce(\n\t\t\t\t\t\timageSizes,\n\t\t\t\t\t\t( currentSizes, size ) => {\n\t\t\t\t\t\t\tconst defaultUrl = get( image, [\n\t\t\t\t\t\t\t\t'sizes',\n\t\t\t\t\t\t\t\tsize.slug,\n\t\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t] );\n\t\t\t\t\t\t\tconst mediaDetailsUrl = get( image, [\n\t\t\t\t\t\t\t\t'media_details',\n\t\t\t\t\t\t\t\t'sizes',\n\t\t\t\t\t\t\t\tsize.slug,\n\t\t\t\t\t\t\t\t'source_url',\n\t\t\t\t\t\t\t] );\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...currentSizes,\n\t\t\t\t\t\t\t\t[ size.slug ]: defaultUrl || mediaDetailsUrl,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{}\n\t\t\t\t\t);\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...currentResizedImages,\n\t\t\t\t\t\t[ parseInt( id, 10 ) ]: sizes,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\t{}\n\t\t\t);\n\t\t}\n\n\t\treturn {\n\t\t\timageSizes,\n\t\t\tmediaUpload,\n\t\t\tresizedImages,\n\t\t};\n\t} ),\n\twithNotices,\n\twithViewportMatch( { isNarrow: '< small' } ),\n] )( GalleryEdit );\n"]}