{"version":3,"sources":["@wordpress/block-library/src/query/edit/query-inspector-controls.js"],"names":["debounce","PanelBody","QueryControls","TextControl","FormTokenField","SelectControl","__","InspectorControls","useSelect","useEffect","useState","useCallback","useMemo","getTermsInfo","MAX_FETCHED_TERMS","QueryInspectorControls","query","setQuery","order","orderBy","selectedAuthorId","author","postType","showCategories","setShowCategories","showTags","setShowTags","select","getEntityRecords","getPostTypes","termsQuery","per_page","_categories","_tags","excludedPostTypes","filteredPostTypes","filter","viewable","slug","includes","categories","tags","authorList","postTypes","postTypesTaxonomiesMap","length","reduce","accumulator","type","taxonomies","postTypeTaxonomies","postTypesSelectOptions","map","labels","label","singular_name","value","onPostTypeChange","newValue","updateQuery","categoryIds","tagIds","onTermsChange","terms","queryProperty","newTermValues","termIds","termValue","termId","id","mapByName","push","onCategoriesChange","onTagsChange","search","querySearch","setQuerySearch","onChangeDebounced","cancel","categoryId","mapById","name","names","tagId","undefined"],"mappings":";;;;;AAAA;;;AAGA,SAASA,QAAT,QAAyB,QAAzB;AAEA;;;;AAIA,SACCC,SADD,EAECC,aAFD,EAGCC,WAHD,EAICC,cAJD,EAKCC,aALD,QAMO,uBANP;AAOA,SAASC,EAAT,QAAmB,iBAAnB;AACA,SAASC,iBAAT,QAAkC,yBAAlC;AACA,SAASC,SAAT,QAA0B,iBAA1B;AACA,SAASC,SAAT,EAAoBC,QAApB,EAA8BC,WAA9B,EAA2CC,OAA3C,QAA0D,oBAA1D;AAEA;;;;AAGA,SAASC,YAAT,QAA6B,UAA7B;AACA,SAASC,iBAAT,QAAkC,cAAlC;AAEA,eAAe,SAASC,sBAAT,OAAuD;AAAA;;AAAA,MAApBC,KAAoB,QAApBA,KAAoB;AAAA,MAAbC,QAAa,QAAbA,QAAa;AAAA,MAC7DC,KAD6D,GACNF,KADM,CAC7DE,KAD6D;AAAA,MACtDC,OADsD,GACNH,KADM,CACtDG,OADsD;AAAA,MACrCC,gBADqC,GACNJ,KADM,CAC7CK,MAD6C;AAAA,MACnBC,QADmB,GACNN,KADM,CACnBM,QADmB;;AAAA,kBAEvBZ,QAAQ,CAAE,IAAF,CAFe;AAAA;AAAA,MAE7Da,cAF6D;AAAA,MAE7CC,iBAF6C;;AAAA,mBAGnCd,QAAQ,CAAE,IAAF,CAH2B;AAAA;AAAA,MAG7De,QAH6D;AAAA,MAGnDC,WAHmD;;AAAA,mBAIjBlB,SAAS,CAC5D,UAAEmB,MAAF,EAAc;AAAA;;AAAA,kBAC8BA,MAAM,CAAE,MAAF,CADpC;AAAA,QACLC,gBADK,WACLA,gBADK;AAAA,QACaC,YADb,WACaA,YADb;;AAEb,QAAMC,UAAU,GAAG;AAAEC,MAAAA,QAAQ,EAAEjB;AAAZ,KAAnB;;AACA,QAAMkB,WAAW,GAAGJ,gBAAgB,CACnC,UADmC,EAEnC,UAFmC,EAGnCE,UAHmC,CAApC;;AAKA,QAAMG,KAAK,GAAGL,gBAAgB,CAC7B,UAD6B,EAE7B,UAF6B,EAG7BE,UAH6B,CAA9B;;AAKA,QAAMI,iBAAiB,GAAG,CAAE,YAAF,CAA1B;AACA,QAAMC,iBAAiB,oBAAGN,YAAY,EAAf,kDAAG,cAAgBO,MAAhB,CACzB;AAAA,UAAIC,QAAJ,SAAIA,QAAJ;AAAA,UAAcC,IAAd,SAAcA,IAAd;AAAA,aACCD,QAAQ,IAAI,CAAEH,iBAAiB,CAACK,QAAlB,CAA4BD,IAA5B,CADf;AAAA,KADyB,CAA1B;AAIA,WAAO;AACNE,MAAAA,UAAU,EAAE3B,YAAY,CAAEmB,WAAF,CADlB;AAENS,MAAAA,IAAI,EAAE5B,YAAY,CAAEoB,KAAF,CAFZ;AAGNS,MAAAA,UAAU,EAAEd,gBAAgB,CAAE,MAAF,EAAU,MAAV,EAAkB;AAC7CG,QAAAA,QAAQ,EAAE,CAAC;AADkC,OAAlB,CAHtB;AAMNY,MAAAA,SAAS,EAAER;AANL,KAAP;AAQA,GA3B2D,EA4B5D,EA5B4D,CAJQ;AAAA,MAI7DO,UAJ6D,cAI7DA,UAJ6D;AAAA,MAIjDF,UAJiD,cAIjDA,UAJiD;AAAA,MAIrCC,IAJqC,cAIrCA,IAJqC;AAAA,MAI/BE,SAJ+B,cAI/BA,SAJ+B;;AAkCrE,MAAMC,sBAAsB,GAAGhC,OAAO,CAAE,YAAM;AAC7C,QAAK,EAAE+B,SAAF,aAAEA,SAAF,uBAAEA,SAAS,CAAEE,MAAb,CAAL,EAA2B;AAC3B,WAAOF,SAAS,CAACG,MAAV,CAAkB,UAAEC,WAAF,EAAeC,IAAf,EAAyB;AACjDD,MAAAA,WAAW,CAAEC,IAAI,CAACV,IAAP,CAAX,GAA2BU,IAAI,CAACC,UAAhC;AACA,aAAOF,WAAP;AACA,KAHM,EAGJ,EAHI,CAAP;AAIA,GANqC,EAMnC,CAAEJ,SAAF,CANmC,CAAtC;AAOAlC,EAAAA,SAAS,CAAE,YAAM;AAChB,QAAK,CAAEmC,sBAAP,EAAgC;AAChC,QAAMM,kBAAkB,GAAGN,sBAAsB,CAAEtB,QAAF,CAAjD;AACAE,IAAAA,iBAAiB,CAAE0B,kBAAkB,CAACX,QAAnB,CAA6B,UAA7B,CAAF,CAAjB;AACAb,IAAAA,WAAW,CAAEwB,kBAAkB,CAACX,QAAnB,CAA6B,UAA7B,CAAF,CAAX;AACA,GALQ,EAKN,CAAEjB,QAAF,EAAYsB,sBAAZ,CALM,CAAT;AAMA,MAAMO,sBAAsB,GAAGvC,OAAO,CACrC;AAAA,WACC,CAAE+B,SAAS,IAAI,EAAf,EAAoBS,GAApB,CAAyB;AAAA,UAAIC,MAAJ,SAAIA,MAAJ;AAAA,UAAYf,IAAZ,SAAYA,IAAZ;AAAA,aAA0B;AAClDgB,QAAAA,KAAK,EAAED,MAAM,CAACE,aADoC;AAElDC,QAAAA,KAAK,EAAElB;AAF2C,OAA1B;AAAA,KAAzB,CADD;AAAA,GADqC,EAMrC,CAAEK,SAAF,CANqC,CAAtC;;AAQA,MAAMc,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAEC,QAAF,EAAgB;AACxC,QAAMC,WAAW,GAAG;AAAErC,MAAAA,QAAQ,EAAEoC;AAAZ,KAApB;;AACA,QAAK,CAAEd,sBAAsB,CAAEc,QAAF,CAAtB,CAAmCnB,QAAnC,CAA6C,UAA7C,CAAP,EAAmE;AAClEoB,MAAAA,WAAW,CAACC,WAAZ,GAA0B,EAA1B;AACA;;AACD,QAAK,CAAEhB,sBAAsB,CAAEc,QAAF,CAAtB,CAAmCnB,QAAnC,CAA6C,UAA7C,CAAP,EAAmE;AAClEoB,MAAAA,WAAW,CAACE,MAAZ,GAAqB,EAArB;AACA;;AACD5C,IAAAA,QAAQ,CAAE0C,WAAF,CAAR;AACA,GATD,CAvDqE,CAiErE;;;AACA,MAAMG,aAAa,GAAG,SAAhBA,aAAgB,CAAEC,KAAF,EAASC,aAAT;AAAA,WAA4B,UAAEC,aAAF,EAAqB;AACtE,UAAMC,OAAO,GAAGD,aAAa,CAACnB,MAAd,CAAsB,UAAEC,WAAF,EAAeoB,SAAf,EAA8B;AAAA;;AACnE,YAAMC,MAAM,GAAG,CAAAD,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAEE,EAAX,+BAAiBN,KAAK,CAACO,SAAN,CAAiBH,SAAjB,CAAjB,0DAAiB,sBAA8BE,EAA/C,CAAf;AACA,YAAKD,MAAL,EAAcrB,WAAW,CAACwB,IAAZ,CAAkBH,MAAlB;AACd,eAAOrB,WAAP;AACA,OAJe,EAIb,EAJa,CAAhB;AAKA9B,MAAAA,QAAQ,qBAAM+C,aAAN,EAAuBE,OAAvB,EAAR;AACA,KAPqB;AAAA,GAAtB;;AAQA,MAAMM,kBAAkB,GAAGV,aAAa,CAAEtB,UAAF,EAAc,aAAd,CAAxC;AACA,MAAMiC,YAAY,GAAGX,aAAa,CAAErB,IAAF,EAAQ,QAAR,CAAlC;;AA3EqE,mBA6E7B/B,QAAQ,CAAEM,KAAK,CAAC0D,MAAR,CA7EqB;AAAA;AAAA,MA6E7DC,WA7E6D;AAAA,MA6EhDC,cA7EgD;;AA8ErE,MAAMC,iBAAiB,GAAGlE,WAAW,CACpCX,QAAQ,CAAE;AAAA,WAAMiB,QAAQ,CAAE;AAAEyD,MAAAA,MAAM,EAAEC;AAAV,KAAF,CAAd;AAAA,GAAF,EAA6C,GAA7C,CAD4B,EAEpC,CAAEA,WAAF,CAFoC,CAArC;AAIAlE,EAAAA,SAAS,CAAE,YAAM;AAChBoE,IAAAA,iBAAiB;AACjB,WAAOA,iBAAiB,CAACC,MAAzB;AACA,GAHQ,EAGN,CAAEH,WAAF,EAAeE,iBAAf,CAHM,CAAT;AAIA,SACC,cAAC,iBAAD,QACC,cAAC,SAAD;AAAW,IAAA,KAAK,EAAGvE,EAAE,CAAE,uBAAF;AAArB,KACC,cAAC,aAAD;AACC,IAAA,OAAO,EAAG6C,sBADX;AAEC,IAAA,KAAK,EAAG7B,QAFT;AAGC,IAAA,KAAK,EAAGhB,EAAE,CAAE,WAAF,CAHX;AAIC,IAAA,QAAQ,EAAGmD;AAJZ,IADD,EAOGlC,cAAc,IAAI,CAAAiB,UAAU,SAAV,IAAAA,UAAU,WAAV,iCAAAA,UAAU,CAAEuB,KAAZ,wEAAmBlB,MAAnB,IAA4B,CAA9C,IACD,cAAC,cAAD;AACC,IAAA,KAAK,EAAGvC,EAAE,CAAE,YAAF,CADX;AAEC,IAAA,KAAK,EAAG,CAAEU,KAAK,CAAC4C,WAAN,IAAqB,EAAvB,EAA4BR,GAA5B,CACP,UAAE2B,UAAF;AAAA,aAAoB;AACnBV,QAAAA,EAAE,EAAEU,UADe;AAEnBvB,QAAAA,KAAK,EAAEhB,UAAU,CAACwC,OAAX,CAAoBD,UAApB,EAAiCE;AAFrB,OAApB;AAAA,KADO,CAFT;AAQC,IAAA,WAAW,EAAGzC,UAAU,CAAC0C,KAR1B;AASC,IAAA,QAAQ,EAAGV;AATZ,IARF,EAoBG/C,QAAQ,IAAI,CAAAgB,IAAI,SAAJ,IAAAA,IAAI,WAAJ,2BAAAA,IAAI,CAAEsB,KAAN,4DAAalB,MAAb,IAAsB,CAAlC,IACD,cAAC,cAAD;AACC,IAAA,KAAK,EAAGvC,EAAE,CAAE,MAAF,CADX;AAEC,IAAA,KAAK,EAAG,CAAEU,KAAK,CAAC6C,MAAN,IAAgB,EAAlB,EAAuBT,GAAvB,CAA4B,UAAE+B,KAAF;AAAA,aAAe;AAClDd,QAAAA,EAAE,EAAEc,KAD8C;AAElD3B,QAAAA,KAAK,EAAEf,IAAI,CAACuC,OAAL,CAAcG,KAAd,EAAsBF;AAFqB,OAAf;AAAA,KAA5B,CAFT;AAMC,IAAA,WAAW,EAAGxC,IAAI,CAACyC,KANpB;AAOC,IAAA,QAAQ,EAAGT;AAPZ,IArBF,EA+BC,cAAC,aAAD,WACM;AAAEvD,IAAAA,KAAK,EAALA,KAAF;AAASC,IAAAA,OAAO,EAAPA,OAAT;AAAkBC,IAAAA,gBAAgB,EAAhBA,gBAAlB;AAAoCsB,IAAAA,UAAU,EAAVA;AAApC,GADN;AAEC,IAAA,aAAa,EAAG,uBAAEc,KAAF;AAAA,aAAavC,QAAQ,CAAE;AAAEC,QAAAA,KAAK,EAAEsC;AAAT,OAAF,CAArB;AAAA,KAFjB;AAGC,IAAA,eAAe,EAAG,yBAAEA,KAAF;AAAA,aACjBvC,QAAQ,CAAE;AAAEE,QAAAA,OAAO,EAAEqC;AAAX,OAAF,CADS;AAAA,KAHnB;AAMC,IAAA,cAAc,EAAG,wBAAEA,KAAF;AAAA,aAChBvC,QAAQ,CAAE;AACTI,QAAAA,MAAM,EAAEmC,KAAK,KAAK,EAAV,GAAe,CAACA,KAAhB,GAAwB4B;AADvB,OAAF,CADQ;AAAA;AANlB,KA/BD,EA2CC,cAAC,WAAD;AACC,IAAA,KAAK,EAAG9E,EAAE,CAAE,QAAF,CADX;AAEC,IAAA,KAAK,EAAGqE,WAFT;AAGC,IAAA,QAAQ,EAAGC;AAHZ,IA3CD,CADD,CADD;AAqDA","sourcesContent":["/**\n * External dependencies\n */\nimport { debounce } from 'lodash';\n\n/**\n * WordPress dependencies\n */\n\nimport {\n\tPanelBody,\n\tQueryControls,\n\tTextControl,\n\tFormTokenField,\n\tSelectControl,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { InspectorControls } from '@wordpress/block-editor';\nimport { useSelect } from '@wordpress/data';\nimport { useEffect, useState, useCallback, useMemo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { getTermsInfo } from '../utils';\nimport { MAX_FETCHED_TERMS } from '../constants';\n\nexport default function QueryInspectorControls( { query, setQuery } ) {\n\tconst { order, orderBy, author: selectedAuthorId, postType } = query;\n\tconst [ showCategories, setShowCategories ] = useState( true );\n\tconst [ showTags, setShowTags ] = useState( true );\n\tconst { authorList, categories, tags, postTypes } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getEntityRecords, getPostTypes } = select( 'core' );\n\t\t\tconst termsQuery = { per_page: MAX_FETCHED_TERMS };\n\t\t\tconst _categories = getEntityRecords(\n\t\t\t\t'taxonomy',\n\t\t\t\t'category',\n\t\t\t\ttermsQuery\n\t\t\t);\n\t\t\tconst _tags = getEntityRecords(\n\t\t\t\t'taxonomy',\n\t\t\t\t'post_tag',\n\t\t\t\ttermsQuery\n\t\t\t);\n\t\t\tconst excludedPostTypes = [ 'attachment' ];\n\t\t\tconst filteredPostTypes = getPostTypes()?.filter(\n\t\t\t\t( { viewable, slug } ) =>\n\t\t\t\t\tviewable && ! excludedPostTypes.includes( slug )\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tcategories: getTermsInfo( _categories ),\n\t\t\t\ttags: getTermsInfo( _tags ),\n\t\t\t\tauthorList: getEntityRecords( 'root', 'user', {\n\t\t\t\t\tper_page: -1,\n\t\t\t\t} ),\n\t\t\t\tpostTypes: filteredPostTypes,\n\t\t\t};\n\t\t},\n\t\t[]\n\t);\n\tconst postTypesTaxonomiesMap = useMemo( () => {\n\t\tif ( ! postTypes?.length ) return;\n\t\treturn postTypes.reduce( ( accumulator, type ) => {\n\t\t\taccumulator[ type.slug ] = type.taxonomies;\n\t\t\treturn accumulator;\n\t\t}, {} );\n\t}, [ postTypes ] );\n\tuseEffect( () => {\n\t\tif ( ! postTypesTaxonomiesMap ) return;\n\t\tconst postTypeTaxonomies = postTypesTaxonomiesMap[ postType ];\n\t\tsetShowCategories( postTypeTaxonomies.includes( 'category' ) );\n\t\tsetShowTags( postTypeTaxonomies.includes( 'post_tag' ) );\n\t}, [ postType, postTypesTaxonomiesMap ] );\n\tconst postTypesSelectOptions = useMemo(\n\t\t() =>\n\t\t\t( postTypes || [] ).map( ( { labels, slug } ) => ( {\n\t\t\t\tlabel: labels.singular_name,\n\t\t\t\tvalue: slug,\n\t\t\t} ) ),\n\t\t[ postTypes ]\n\t);\n\tconst onPostTypeChange = ( newValue ) => {\n\t\tconst updateQuery = { postType: newValue };\n\t\tif ( ! postTypesTaxonomiesMap[ newValue ].includes( 'category' ) ) {\n\t\t\tupdateQuery.categoryIds = [];\n\t\t}\n\t\tif ( ! postTypesTaxonomiesMap[ newValue ].includes( 'post_tag' ) ) {\n\t\t\tupdateQuery.tagIds = [];\n\t\t}\n\t\tsetQuery( updateQuery );\n\t};\n\t// Handles categories and tags changes.\n\tconst onTermsChange = ( terms, queryProperty ) => ( newTermValues ) => {\n\t\tconst termIds = newTermValues.reduce( ( accumulator, termValue ) => {\n\t\t\tconst termId = termValue?.id || terms.mapByName[ termValue ]?.id;\n\t\t\tif ( termId ) accumulator.push( termId );\n\t\t\treturn accumulator;\n\t\t}, [] );\n\t\tsetQuery( { [ queryProperty ]: termIds } );\n\t};\n\tconst onCategoriesChange = onTermsChange( categories, 'categoryIds' );\n\tconst onTagsChange = onTermsChange( tags, 'tagIds' );\n\n\tconst [ querySearch, setQuerySearch ] = useState( query.search );\n\tconst onChangeDebounced = useCallback(\n\t\tdebounce( () => setQuery( { search: querySearch } ), 250 ),\n\t\t[ querySearch ]\n\t);\n\tuseEffect( () => {\n\t\tonChangeDebounced();\n\t\treturn onChangeDebounced.cancel;\n\t}, [ querySearch, onChangeDebounced ] );\n\treturn (\n\t\t<InspectorControls>\n\t\t\t<PanelBody title={ __( 'Filtering and Sorting' ) }>\n\t\t\t\t<SelectControl\n\t\t\t\t\toptions={ postTypesSelectOptions }\n\t\t\t\t\tvalue={ postType }\n\t\t\t\t\tlabel={ __( 'Post Type' ) }\n\t\t\t\t\tonChange={ onPostTypeChange }\n\t\t\t\t/>\n\t\t\t\t{ showCategories && categories?.terms?.length > 0 && (\n\t\t\t\t\t<FormTokenField\n\t\t\t\t\t\tlabel={ __( 'Categories' ) }\n\t\t\t\t\t\tvalue={ ( query.categoryIds || [] ).map(\n\t\t\t\t\t\t\t( categoryId ) => ( {\n\t\t\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\t\t\tvalue: categories.mapById[ categoryId ].name,\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tsuggestions={ categories.names }\n\t\t\t\t\t\tonChange={ onCategoriesChange }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t{ showTags && tags?.terms?.length > 0 && (\n\t\t\t\t\t<FormTokenField\n\t\t\t\t\t\tlabel={ __( 'Tags' ) }\n\t\t\t\t\t\tvalue={ ( query.tagIds || [] ).map( ( tagId ) => ( {\n\t\t\t\t\t\t\tid: tagId,\n\t\t\t\t\t\t\tvalue: tags.mapById[ tagId ].name,\n\t\t\t\t\t\t} ) ) }\n\t\t\t\t\t\tsuggestions={ tags.names }\n\t\t\t\t\t\tonChange={ onTagsChange }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t<QueryControls\n\t\t\t\t\t{ ...{ order, orderBy, selectedAuthorId, authorList } }\n\t\t\t\t\tonOrderChange={ ( value ) => setQuery( { order: value } ) }\n\t\t\t\t\tonOrderByChange={ ( value ) =>\n\t\t\t\t\t\tsetQuery( { orderBy: value } )\n\t\t\t\t\t}\n\t\t\t\t\tonAuthorChange={ ( value ) =>\n\t\t\t\t\t\tsetQuery( {\n\t\t\t\t\t\t\tauthor: value !== '' ? +value : undefined,\n\t\t\t\t\t\t} )\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<TextControl\n\t\t\t\t\tlabel={ __( 'Search' ) }\n\t\t\t\t\tvalue={ querySearch }\n\t\t\t\t\tonChange={ setQuerySearch }\n\t\t\t\t/>\n\t\t\t</PanelBody>\n\t\t</InspectorControls>\n\t);\n}\n"]}