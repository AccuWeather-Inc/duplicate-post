{"version":3,"sources":["@wordpress/edit-post/src/editor.native.js"],"names":["memize","size","map","without","I18nManager","Component","EditorProvider","parse","serialize","rawHandler","withDispatch","withSelect","compose","subscribeSetFocusOnTitle","SlotFillProvider","Preview","Layout","Editor","props","arguments","initialHtmlModeEnabled","mode","switchEditorMode","getEditorSettings","maxSize","setTitleRef","bind","settings","hasFixedToolbar","focusMode","hiddenBlockTypes","blockTypes","colors","gradients","isRTL","defaultAllowedBlockTypes","allowedBlockTypes","undefined","subscriptionParentSetFocusOnTitle","postTitleRef","focus","remove","titleRef","initialHtml","editorMode","HTML","initialEdits","post","postId","postType","editorSettings","normalizedPost","id","title","raw","initialTitle","content","type","status","meta","select","isFeatureActive","getEditorMode","getPreference","__experimentalGetPreviewDeviceType","getBlockTypes","dispatch"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport memize from 'memize';\nimport { size, map, without } from 'lodash';\nimport { I18nManager } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { EditorProvider } from '@wordpress/editor';\nimport { parse, serialize, rawHandler } from '@wordpress/blocks';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { subscribeSetFocusOnTitle } from '@wordpress/react-native-bridge';\nimport { SlotFillProvider } from '@wordpress/components';\nimport { Preview } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport Layout from './components/layout';\n\nclass Editor extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\n\t\tif ( props.initialHtmlModeEnabled && props.mode === 'visual' ) {\n\t\t\t// enable html mode if the initial mode the parent wants it but we're not already in it\n\t\t\tthis.props.switchEditorMode( 'text' );\n\t\t}\n\n\t\tthis.getEditorSettings = memize( this.getEditorSettings, {\n\t\t\tmaxSize: 1,\n\t\t} );\n\n\t\tthis.setTitleRef = this.setTitleRef.bind( this );\n\t}\n\n\tgetEditorSettings(\n\t\tsettings,\n\t\thasFixedToolbar,\n\t\tfocusMode,\n\t\thiddenBlockTypes,\n\t\tblockTypes,\n\t\tcolors,\n\t\tgradients\n\t) {\n\t\tsettings = {\n\t\t\t...settings,\n\t\t\tisRTL: I18nManager.isRTL,\n\t\t\thasFixedToolbar,\n\t\t\tfocusMode,\n\t\t};\n\n\t\t// Omit hidden block types if exists and non-empty.\n\t\tif ( size( hiddenBlockTypes ) > 0 ) {\n\t\t\t// Defer to passed setting for `allowedBlockTypes` if provided as\n\t\t\t// anything other than `true` (where `true` is equivalent to allow\n\t\t\t// all block types).\n\t\t\tconst defaultAllowedBlockTypes =\n\t\t\t\ttrue === settings.allowedBlockTypes\n\t\t\t\t\t? map( blockTypes, 'name' )\n\t\t\t\t\t: settings.allowedBlockTypes || [];\n\n\t\t\tsettings.allowedBlockTypes = without(\n\t\t\t\tdefaultAllowedBlockTypes,\n\t\t\t\t...hiddenBlockTypes\n\t\t\t);\n\t\t}\n\n\t\tif ( colors !== undefined ) {\n\t\t\tsettings.colors = colors;\n\t\t}\n\n\t\tif ( gradients !== undefined ) {\n\t\t\tsettings.gradients = gradients;\n\t\t}\n\n\t\treturn settings;\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.subscriptionParentSetFocusOnTitle = subscribeSetFocusOnTitle(\n\t\t\t() => {\n\t\t\t\tif ( this.postTitleRef ) {\n\t\t\t\t\tthis.postTitleRef.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this.subscriptionParentSetFocusOnTitle ) {\n\t\t\tthis.subscriptionParentSetFocusOnTitle.remove();\n\t\t}\n\t}\n\n\tsetTitleRef( titleRef ) {\n\t\tthis.postTitleRef = titleRef;\n\t}\n\n\teditorMode( initialHtml, editorMode ) {\n\t\tif ( editorMode === 'preview' ) {\n\t\t\treturn <Preview blocks={ rawHandler( { HTML: initialHtml } ) } />;\n\t\t}\n\t\treturn <Layout setTitleRef={ this.setTitleRef } />;\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tsettings,\n\t\t\thasFixedToolbar,\n\t\t\tfocusMode,\n\t\t\tinitialEdits,\n\t\t\thiddenBlockTypes,\n\t\t\tblockTypes,\n\t\t\tpost,\n\t\t\tpostId,\n\t\t\tpostType,\n\t\t\tcolors,\n\t\t\tgradients,\n\t\t\tinitialHtml,\n\t\t\teditorMode,\n\t\t\t...props\n\t\t} = this.props;\n\n\t\tconst editorSettings = this.getEditorSettings(\n\t\t\tsettings,\n\t\t\thasFixedToolbar,\n\t\t\tfocusMode,\n\t\t\thiddenBlockTypes,\n\t\t\tblockTypes,\n\t\t\tcolors,\n\t\t\tgradients\n\t\t);\n\n\t\tconst normalizedPost = post || {\n\t\t\tid: postId,\n\t\t\ttitle: {\n\t\t\t\traw: props.initialTitle || '',\n\t\t\t},\n\t\t\tcontent: {\n\t\t\t\t// make sure the post content is in sync with gutenberg store\n\t\t\t\t// to avoid marking the post as modified when simply loaded\n\t\t\t\t// For now, let's assume: serialize( parse( html ) ) !== html\n\t\t\t\traw: serialize( parse( initialHtml || '' ) ),\n\t\t\t},\n\t\t\ttype: postType,\n\t\t\tstatus: 'draft',\n\t\t\tmeta: [],\n\t\t};\n\n\t\treturn (\n\t\t\t<SlotFillProvider>\n\t\t\t\t<EditorProvider\n\t\t\t\t\tsettings={ editorSettings }\n\t\t\t\t\tpost={ normalizedPost }\n\t\t\t\t\tinitialEdits={ initialEdits }\n\t\t\t\t\tuseSubRegistry={ false }\n\t\t\t\t\t{ ...props }\n\t\t\t\t>\n\t\t\t\t\t{ this.editorMode( initialHtml, editorMode ) }\n\t\t\t\t</EditorProvider>\n\t\t\t</SlotFillProvider>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst {\n\t\t\tisFeatureActive,\n\t\t\tgetEditorMode,\n\t\t\tgetPreference,\n\t\t\t__experimentalGetPreviewDeviceType,\n\t\t} = select( 'core/edit-post' );\n\t\tconst { getBlockTypes } = select( 'core/blocks' );\n\n\t\treturn {\n\t\t\thasFixedToolbar:\n\t\t\t\tisFeatureActive( 'fixedToolbar' ) ||\n\t\t\t\t__experimentalGetPreviewDeviceType() !== 'Desktop',\n\t\t\tfocusMode: isFeatureActive( 'focusMode' ),\n\t\t\tmode: getEditorMode(),\n\t\t\thiddenBlockTypes: getPreference( 'hiddenBlockTypes' ),\n\t\t\tblockTypes: getBlockTypes(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { switchEditorMode } = dispatch( 'core/edit-post' );\n\n\t\treturn {\n\t\t\tswitchEditorMode,\n\t\t};\n\t} ),\n] )( Editor );\n"]}