{"version":3,"sources":["@wordpress/components/src/combobox-control/index.js"],"names":["classnames","__","_n","sprintf","useState","useMemo","useRef","useEffect","useInstanceId","ENTER","UP","DOWN","ESCAPE","speak","closeSmall","TokenInput","SuggestionsList","BaseControl","Button","Flex","FlexBlock","FlexItem","ComboboxControl","value","label","options","onChange","onFilterValueChange","hideLabelFromVision","help","allowReset","className","messages","selected","instanceId","selectedSuggestion","setSelectedSuggestion","isExpanded","setIsExpanded","inputValue","setInputValue","inputContainer","currentOption","find","option","currentLabel","matchingSuggestions","startsWithMatch","containsMatch","match","toLocaleLowerCase","forEach","index","indexOf","push","concat","onSuggestionSelected","newSelectedSuggestion","handleArrowNavigation","offset","nextIndex","length","onKeyDown","event","preventDefault","keyCode","stopPropagation","onFocus","onBlur","onInputChange","text","handleOnReset","current","input","focus","hasMatchingSuggestions","message","suggestion"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport { useState, useMemo, useRef, useEffect } from '@wordpress/element';\nimport { useInstanceId } from '@wordpress/compose';\nimport { ENTER, UP, DOWN, ESCAPE } from '@wordpress/keycodes';\nimport { speak } from '@wordpress/a11y';\nimport { closeSmall } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport TokenInput from '../form-token-field/token-input';\nimport SuggestionsList from '../form-token-field/suggestions-list';\nimport BaseControl from '../base-control';\nimport Button from '../button';\nimport { Flex, FlexBlock, FlexItem } from '../flex';\n\nfunction ComboboxControl( {\n\tvalue,\n\tlabel,\n\toptions,\n\tonChange,\n\tonFilterValueChange,\n\thideLabelFromVision,\n\thelp,\n\tallowReset = true,\n\tclassName,\n\tmessages = {\n\t\tselected: __( 'Item selected.' ),\n\t},\n} ) {\n\tconst instanceId = useInstanceId( ComboboxControl );\n\tconst [ selectedSuggestion, setSelectedSuggestion ] = useState( null );\n\tconst [ isExpanded, setIsExpanded ] = useState( false );\n\tconst [ inputValue, setInputValue ] = useState( '' );\n\tconst inputContainer = useRef();\n\tconst currentOption = options.find( ( option ) => option.value === value );\n\tconst currentLabel = currentOption?.label ?? '';\n\n\tconst matchingSuggestions = useMemo( () => {\n\t\tconst startsWithMatch = [];\n\t\tconst containsMatch = [];\n\t\tconst match = inputValue.toLocaleLowerCase();\n\t\toptions.forEach( ( option ) => {\n\t\t\tconst index = option.label.toLocaleLowerCase().indexOf( match );\n\t\t\tif ( index === 0 ) {\n\t\t\t\tstartsWithMatch.push( option );\n\t\t\t} else if ( index > 0 ) {\n\t\t\t\tcontainsMatch.push( option );\n\t\t\t}\n\t\t} );\n\n\t\treturn startsWithMatch.concat( containsMatch );\n\t}, [ inputValue, options, value ] );\n\n\tconst onSuggestionSelected = ( newSelectedSuggestion ) => {\n\t\tonChange( newSelectedSuggestion.value );\n\t\tspeak( messages.selected, 'assertive' );\n\t\tsetSelectedSuggestion( newSelectedSuggestion );\n\t\tsetInputValue( '' );\n\t\tsetIsExpanded( false );\n\t};\n\n\tconst handleArrowNavigation = ( offset = 1 ) => {\n\t\tconst index = matchingSuggestions.indexOf( selectedSuggestion );\n\t\tlet nextIndex = index + offset;\n\t\tif ( nextIndex < 0 ) {\n\t\t\tnextIndex = matchingSuggestions.length - 1;\n\t\t} else if ( nextIndex >= matchingSuggestions.length ) {\n\t\t\tnextIndex = 0;\n\t\t}\n\t\tsetSelectedSuggestion( matchingSuggestions[ nextIndex ] );\n\t\tsetIsExpanded( true );\n\t};\n\n\tconst onKeyDown = ( event ) => {\n\t\tlet preventDefault = false;\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase ENTER:\n\t\t\t\tif ( selectedSuggestion ) {\n\t\t\t\t\tonSuggestionSelected( selectedSuggestion );\n\t\t\t\t\tpreventDefault = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UP:\n\t\t\t\thandleArrowNavigation( -1 );\n\t\t\t\tpreventDefault = true;\n\t\t\t\tbreak;\n\t\t\tcase DOWN:\n\t\t\t\thandleArrowNavigation( 1 );\n\t\t\t\tpreventDefault = true;\n\t\t\t\tbreak;\n\t\t\tcase ESCAPE:\n\t\t\t\tsetIsExpanded( false );\n\t\t\t\tsetSelectedSuggestion( null );\n\t\t\t\tpreventDefault = true;\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( preventDefault ) {\n\t\t\tevent.preventDefault();\n\t\t}\n\t};\n\n\tconst onFocus = () => {\n\t\tsetIsExpanded( true );\n\t\tonFilterValueChange( '' );\n\t\tsetInputValue( '' );\n\t};\n\n\tconst onBlur = () => {\n\t\tsetIsExpanded( false );\n\t};\n\n\tconst onInputChange = ( event ) => {\n\t\tconst text = event.value;\n\t\tsetInputValue( text );\n\t\tonFilterValueChange( text );\n\t\tsetIsExpanded( true );\n\t};\n\n\tconst handleOnReset = () => {\n\t\tonChange( null );\n\t\tinputContainer.current.input.focus();\n\t};\n\n\t// Announcements\n\tuseEffect( () => {\n\t\tconst hasMatchingSuggestions = matchingSuggestions.length > 0;\n\t\tif ( isExpanded ) {\n\t\t\tconst message = hasMatchingSuggestions\n\t\t\t\t? sprintf(\n\t\t\t\t\t\t/* translators: %d: number of results. */\n\t\t\t\t\t\t_n(\n\t\t\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t\tmatchingSuggestions.length\n\t\t\t\t\t\t),\n\t\t\t\t\t\tmatchingSuggestions.length\n\t\t\t\t  )\n\t\t\t\t: __( 'No results.' );\n\n\t\t\tspeak( message, 'assertive' );\n\t\t}\n\t}, [ matchingSuggestions, isExpanded ] );\n\n\t// Disable reason: There is no appropriate role which describes the\n\t// input container intended accessible usability.\n\t// TODO: Refactor click detection to use blur to stop propagation.\n\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\treturn (\n\t\t<BaseControl\n\t\t\tclassName={ classnames( className, 'components-combobox-control' ) }\n\t\t\ttabIndex=\"-1\"\n\t\t\tlabel={ label }\n\t\t\tid={ `components-form-token-input-${ instanceId }` }\n\t\t\thideLabelFromVision={ hideLabelFromVision }\n\t\t\thelp={ help }\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName=\"components-combobox-control__suggestions-container\"\n\t\t\t\ttabIndex=\"-1\"\n\t\t\t\tonKeyDown={ onKeyDown }\n\t\t\t>\n\t\t\t\t<Flex>\n\t\t\t\t\t<FlexBlock>\n\t\t\t\t\t\t<TokenInput\n\t\t\t\t\t\t\tclassName=\"components-combobox-control__input\"\n\t\t\t\t\t\t\tinstanceId={ instanceId }\n\t\t\t\t\t\t\tref={ inputContainer }\n\t\t\t\t\t\t\tvalue={ isExpanded ? inputValue : currentLabel }\n\t\t\t\t\t\t\tonBlur={ onBlur }\n\t\t\t\t\t\t\tonFocus={ onFocus }\n\t\t\t\t\t\t\tisExpanded={ isExpanded }\n\t\t\t\t\t\t\tselectedSuggestionIndex={ matchingSuggestions.indexOf(\n\t\t\t\t\t\t\t\tselectedSuggestion\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tonChange={ onInputChange }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FlexBlock>\n\t\t\t\t\t{ allowReset && (\n\t\t\t\t\t\t<FlexItem>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"components-combobox-control__reset\"\n\t\t\t\t\t\t\t\ticon={ closeSmall }\n\t\t\t\t\t\t\t\tdisabled={ ! value }\n\t\t\t\t\t\t\t\tonClick={ handleOnReset }\n\t\t\t\t\t\t\t\tlabel={ __( 'Reset' ) }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FlexItem>\n\t\t\t\t\t) }\n\t\t\t\t</Flex>\n\t\t\t\t{ isExpanded && (\n\t\t\t\t\t<SuggestionsList\n\t\t\t\t\t\tinstanceId={ instanceId }\n\t\t\t\t\t\tmatch={ { label: inputValue } }\n\t\t\t\t\t\tdisplayTransform={ ( suggestion ) => suggestion.label }\n\t\t\t\t\t\tsuggestions={ matchingSuggestions }\n\t\t\t\t\t\tselectedIndex={ matchingSuggestions.indexOf(\n\t\t\t\t\t\t\tselectedSuggestion\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tonHover={ setSelectedSuggestion }\n\t\t\t\t\t\tonSelect={ onSuggestionSelected }\n\t\t\t\t\t\tscrollIntoView\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t</BaseControl>\n\t);\n\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n}\n\nexport default ComboboxControl;\n"]}